schema: 1.0

name: Kali Linux Security Instance
description: A Kali Linux instance for security operations with SSM integration, CloudWatch logging, and auto-termination
version: 1.0.0

deploymentOptions:
  stackName: kali-linux-instance
  permissionModel: SELF_MANAGED
  
parameters:
  - name: VpcId
    type: AWS::EC2::VPC::Id
    label: VPC ID
    description: The VPC ID where the Kali instance will be deployed
    
  - name: SubnetId
    type: AWS::EC2::Subnet::Id
    label: Subnet ID
    description: The Subnet ID where the Kali instance will be deployed
    
  - name: PrivateIp
    type: String
    label: Private IP Address (Optional)
    description: The private IP address to assign to the instance (must be within subnet range)
    default: ""
    
  - name: InstanceType
    type: String
    label: Instance Type
    description: The EC2 instance type for Kali Linux
    default: t3.medium
    allowedValues:
      - t3.medium
      - t3.large
      - m5.large
      - m5.xlarge
      - c5.large
      - c5.xlarge
      
  - name: KeyName
    type: AWS::EC2::KeyPair::KeyName
    label: Key Pair (Optional)
    description: SSH Key Pair for emergency access (using SSM is preferred)
    default: ""
    
  - name: RootVolumeSize
    type: Number
    label: Root Volume Size (GB)
    description: Size of the root EBS volume in GB
    default: 30
    minValue: 20
    maxValue: 100
    
  - name: AutoTerminationTime
    type: Number
    label: Auto-Termination Time (hours)
    description: Time in hours after which the instance will be automatically terminated (1-168 hours)
    default: 24
    minValue: 1
    maxValue: 168
    
  - name: NamePrefix
    type: String
    label: Resource Name Prefix
    description: Prefix to be used in resource naming
    default: kali
    
  - name: Environment
    type: String
    label: Environment
    description: Environment name for tagging resources
    default: security
    allowedValues:
      - security
      - development
      - testing
      - production
      
mappings: {}

resources:
  terraform:
    source: '..'
    inputs:
      vpc_id: ${VpcId}
      subnet_id: ${SubnetId}
      private_ip: ${PrivateIp}
      instance_type: ${InstanceType}
      key_name: ${KeyName}
      root_volume_size: ${RootVolumeSize}
      auto_termination_time: ${AutoTerminationTime}
      name_prefix: ${NamePrefix}
      environment: ${Environment}